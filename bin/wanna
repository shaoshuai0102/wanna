#!/usr/bin/env node

var program = require('commander'),
    pjson = require('../package.json'),
    fs = require('fs'),
    path = require('path');

program
    .version(pjson.version)
    .usage('[options] <command ...>')
    .option('-p, --page', 'when used with write command, you means writing a page instead of a post');


var dir = process.env._;
var stat = fs.lstatSync(dir);
var realpath = stat.isSymbolicLink() ? path.normalize(path.dirname(dir) + '/' + fs.readlinkSync(dir)) : dir;
var dir_lib = path.normalize(path.dirname(realpath) + '/../lib'),
    dir_commands = dir_lib + '/commands';

var commands = fs.readdirSync(dir_commands);

commands.forEach(function(filename) {
    var CMD = require(dir_commands + '/' + filename);
    //console.log(CMD);
    program
        .command(CMD.command)
        .description(CMD.description)
        .action(CMD.action);
});
//console.log(process.env);

program.parse(process.argv);
